services:
  bot:
    build:
      context: ../..
      dockerfile: Dockerfile
    depends_on:
      - telegram-bot-api
    env_file:
      - .env
    environment:
      TELEGRAM_BOT_API_BASE_URL: http://telegram-bot-api:8081/bot
      TELEGRAM_BOT_API_FILE_URL: http://telegram-bot-api:8081/file/bot
      MAX_UPLOAD_SIZE_MB: "2000"
      APP_ENV: self-hosted
      INSTANCE_NAME: selfhost-local
      PORT: "10000"
    ports:
      - "10000:10000"
    volumes:
      - bot-downloads:/app/downloads
    restart: unless-stopped

  telegram-bot-api:
    image: aiogram/telegram-bot-api:latest
    environment:
      TELEGRAM_API_ID: ${TELEGRAM_API_ID}
      TELEGRAM_API_HASH: ${TELEGRAM_API_HASH}
      TELEGRAM_LOCAL: "1"
      TELEGRAM_HTTP_PORT: "8081"
    volumes:
      - tg-bot-api-data:/var/lib/telegram-bot-api
    ports:
      - "8081:8081"
    restart: unless-stopped

volumes:
  bot-downloads:
  tg-bot-api-data:
